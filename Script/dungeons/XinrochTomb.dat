/*
 *
 *  Iter Vehemens ad Necem (IVAN)
 *  Copyright (C) Timo Kiviluoto
 *  Released under the GNU General
 *  Public License
 *
 *  See LICENSING which should be included
 *  along with this file for more details
 *
 */

/*
 * NOTICE!!!
 *
 * This file contains SPOILERS, which might ruin your IVAN experience
 * totally. Also, editing anything can DESTROY GAME BALANCE or CAUSE
 * OBSCURE BUGS if you don't know what you're doing. So from here on,
 * proceed at your own risk!
 */

Dungeon XINROCH_TOMB;
{
  Levels = 11;
  Description = "Tomb of Xinroch";
  ShortDescription = "TX";

  LevelDefault
  {
    FillSquare = GRAVEL solidterrain(GROUND), BASALT earth;
    TunnelSquare = GRAVEL solidterrain(GROUND), 0;
    BackGroundType = GRAY_FRACTAL;
    Size = 64, 36;
    Rooms = 10:30;
    Items = 20:40;
    GenerateMonsters = true;
    IsOnGround = false;
    TeamDefault = MONSTER_TEAM;
    LOSModifier = 16;
    IgnoreDefaultSpecialSquares = false;
    DifficultyBase = 40;
    DifficultyDelta = 15;
    MonsterAmountBase = 12;
    MonsterAmountDelta = 3;
    MonsterGenerationIntervalBase = 128;
    MonsterGenerationIntervalDelta = -8;
    CanGenerateBone = true;
    ItemMinPriceBase = 10;
    ItemMinPriceDelta = 10;
    EnchantmentMinusChanceBase = 0;
    EnchantmentMinusChanceDelta = 0;
    EnchantmentPlusChanceBase = 5;
    EnchantmentPlusChanceDelta = 5;
    IsCatacomb = false;
    EarthquakesAffectTunnels = true;

    Square, Random HAS_NO_OTERRAIN;
    {
      Items == bone;
      Times = 12:24;
    }

    Square, Random HAS_NO_OTERRAIN;
    {
      Items == skull;
      Times = 2:4;
    }

    Square, Random HAS_NO_OTERRAIN;
    {
      Items == mine { Team = MONSTER_TEAM; IsActive = true; }
      Times = 0:3;
    }

    Square, Random HAS_NO_OTERRAIN;
    {
      Items == beartrap { Team = MONSTER_TEAM; IsActive = true; }
      Times = 0:3;
    }

    RoomDefault
    {
      Pos = 2:XSize-5,2:YSize-5;
      Size = 3:9,3:9;
      AltarPossible = true;
      WallSquare = GRAVEL solidterrain(GROUND), BLACK_GRANITE wall(BRICK_OLD);
      FloorSquare = FIR_WOOD solidterrain(PARQUET), 0;
      DoorSquare = FIR_WOOD solidterrain(PARQUET), IRON door;
      GenerateDoor = true;
      DivineMaster = 0;
      GenerateTunnel = true;
      GenerateLanterns = true;
      Type = ROOM_NORMAL;
      GenerateFountains = true;
      AllowLockedDoors = true;
      AllowBoobyTrappedDoors = true;
      Shape = RECTANGLE;
      IsInside = true;
      GenerateWindows = false;
      UseFillSquareWalls = false;
      Flags = 0;
    }
  }

  Level 0; /* Outside the tomb*/
  {
    Description = "the Tomb entrance";
    ShortDescription = "TX Entry";
    FillSquare = SNOW solidterrain(SNOW_TERRAIN), 0;
    Size = 47, 41;
    GenerateMonsters = false;
    Rooms = 2:4;
    Items = 0;
    IsOnGround = true;
    TeamDefault = ATTNAM_TEAM;
    LOSModifier = 48;
    IgnoreDefaultSpecialSquares = true;
    CanGenerateBone = false;
    DifficultyBase = 150;
    DifficultyDelta = 0;
    EnchantmentMinusChanceBase = 0;
    EnchantmentMinusChanceDelta = 0;
    EnchantmentPlusChanceBase = 0;
    EnchantmentPlusChanceDelta = 0;
    BackGroundType = GRAY_FRACTAL;

    RoomDefault
    {
      Pos = 2:XSize-5,2:YSize-10;
      Size = 4:6,4:6;
      AltarPossible = false;
      WallSquare = FIR_WOOD solidterrain(PARQUET), OCTIRON wall(BRICK_FINE);
      FloorSquare = FIR_WOOD solidterrain(PARQUET), 0;
      DoorSquare = FIR_WOOD solidterrain(PARQUET), RUBY door;
      GenerateDoor = true;
      DivineMaster = 0;
      GenerateTunnel = false;
      GenerateLanterns = true;
      Type = ROOM_NORMAL;
      GenerateFountains = false;
      AllowLockedDoors = false;
      AllowBoobyTrappedDoors = false;
      Shape = RECTANGLE;
      IsInside = true;
      GenerateWindows = true;
      UseFillSquareWalls = false;
      Flags = 0;
    }

    Square, Pos 31,31;
    {
      OTerrain = stairs(STAIRS_DOWN);
      EntryIndex = STAIRS_DOWN;
    }

    Room
    {
      Pos = 4,4;
      Size = 21,21;
      GenerateFountains = true;
      GenerateWindows = false;
      /*Shape = MAZE_ROOM;*/
      Shape = RECTANGLE;
      DivineMaster = INFUSCOR;
    }
  }

  Level 1;
  {
    Square, Random NOT_WALKABLE|ATTACHABLE;
    {
      OTerrain = stairs(STAIRS_UP);
      EntryIndex = STAIRS_UP;
      AttachRequired = true;
    }

    Square, Random NOT_WALKABLE|ATTACHABLE;
    {
      OTerrain = stairs(STAIRS_DOWN);
      EntryIndex = STAIRS_DOWN;
      AttachRequired = true;
    }

    Room
    {
      Size = 7,7;
      GenerateFountains = false;
      Shape = ROUND_CORNERS;
      FloorSquare = solidterrain(GROUND), 0;
      UseFillSquareWalls = true;
      GenerateDoor = false;
      GenerateLanterns = false;
      AltarPossible = false;

      Square, Pos 3,0;
      {
        OTerrain = 0;
        AttachRequired = true;
      }
      Square, Pos 0,3;
      {
        OTerrain = 0;
        AttachRequired = true;
      }
      Square, Pos 6,3;
      {
        OTerrain = 0;
        AttachRequired = true;
      }
      Square, Pos 3,6;
      {
        OTerrain = 0;
        AttachRequired = true;
      }
    }

    Room
    {
      Size = 7,7;
      GenerateFountains = false;
      Shape = ROUND_CORNERS;
      FloorSquare = solidterrain(GROUND), 0;
      UseFillSquareWalls = true;
      GenerateDoor = false;
      GenerateLanterns = false;
      AltarPossible = false;

      Square, Pos 3,0;
      {
        OTerrain = 0;
        AttachRequired = true;
      }
      Square, Pos 0,3;
      {
        OTerrain = 0;
        AttachRequired = true;
      }
      Square, Pos 6,3;
      {
        OTerrain = 0;
        AttachRequired = true;
      }
      Square, Pos 3,6;
      {
        OTerrain = 0;
        AttachRequired = true;
      }
    }
  }

  RandomLevel 1:2; /* Paradise room */
  {
    Room
    {
      Size = 14,14;
      AllowLockedDoors = true;
      AllowBoobyTrappedDoors = true;
      GenerateFountains = false;
      Shape = ROUND_CORNERS;
      FloorSquare = solidterrain(GROUND), 0;
      GenerateDoor = false;
      GenerateLanterns = false;
      AltarPossible = false;
      Flags = NO_MONSTER_GENERATION;
      UseFillSquareWalls = true;
      
      Square, Pos 0,6;
      {
        OTerrain = 0;
        AttachRequired = true;
      }
      Square, Pos 7,13;
      {
        OTerrain = 0;
        AttachRequired = true;
      }
      Square, Pos 7,6;
      {
        Items == itemcontainer(LARGE_CHEST);/* { LifeExpectancy = 100:10000; Chance = 5; ItemsInside == Random { MinPrice = 1500; Times = 10; Category = HELMET|AMULET|CLOAK|BODY_ARMOR|WEAPON|SHIELD|RING|GAUNTLET|BELT|BOOT|TOOL|VALUABLE; LifeExpectancy = 100:10000; } }*/
      }
      Square, Pos 8, 6;
      {
        Character = veterankamikazedwarf(INFUSCOR);
      }
      Square, Pos 10, 3;
      {
        Character = veterankamikazedwarf(INFUSCOR);
      }

      OTerrainMap
      {
        Pos = 1,1;
        Size = 12,12;
        Types
        {
          # = 0;
          B = GRAVEL earth;
          t = BALSA_WOOD decoration(PALM);
        }
      }
      {
        ####BBBBBBB#
        ##########BB
        ###########B
        ###########B
        ######t####B
        ###########B
        #######t###B
        ###########B
        ###t#######B
        ############
        #####t####t#
        ############
      }

      GTerrainMap
      {
        Pos = 1,1;
        Size = 12,12;
        Types
        {
          $ = SAND solidterrain(GRASS_TERRAIN);
          # = 0;
          w = WATER liquidterrain(POOL);
          G = GRAVEL solidterrain(GRASS_TERRAIN);
        }
      }
      {
        #$$$GGGGGGG#
        $$$wwwwGGGGG
        $$wwwwwwwGGG
        $$wwwwwwwwwG
        $$www$$wwwwG
        $$www$$$wwwG
        $$wwww$$wwwG
        $$ww$wwwwwwG
        $$w$$$wwwwwG
        $$$$$$$$ww$$
        $$$$$$$$$$$$
        #$$$$$$$$$$#
      }
    }
  }

  RandomLevel 2; /* Lesser maze room */
  {
    Room
    {
      Size = 13,13;
      AltarPossible = true;
      GenerateFountains = true;
      /*Shape = MAZE_ROOM;*/
      Shape = RECTANGLE;
    }
  }

  RandomLevel 4:5; /* Kitchen */
  {
    CanGenerateBone = false;

    Room
    {
      Size = 7,6;
      AltarPossible = false;
      GenerateFountains = false;
      GenerateDoor = false;
      DivineMaster = SEGES;
      GenerateLanterns = false;
      Type = ROOM_SHOP;
      AllowLockedDoors = false;
      AllowBoobyTrappedDoors = false;
      Flags = NO_MONSTER_GENERATION;

      Square, Pos 3, 5;
      {
        GTerrain = solidterrain(PARQUET);
        OTerrain = door;
        AttachRequired = true;
      }
      Square, Pos 1,1;
      {
        Character = shopkeeper(XINROCH_TOMB) { Team = 5; Flags = IS_MASTER; }
      }
      Square, Pos 2,2;
      {
        OTerrain = fountain;
      }

      OTerrainMap
      {
        Pos = 1,1;
        Size = 5,4;
        Types
        {
          = = olterraincontainer(SHELF) { ItemsInside = { 2, Random { MinPrice = 50; MaxPrice = 100; Category = FOOD; }, Random { MinPrice = 100; Category = POTION; } } }
          % = olterraincontainer(SHELF) { ItemsInside = { 2, Random { MinPrice = 40; MaxPrice = 100; Category = FOOD; }, Random { MinPrice = 20; MaxPrice = 100; Category = FOOD; } } }
        }
      }
      {
        ....%
        ....=
        ....%
        ....%
      }
    }
  }

  RandomLevel 4:6; /* Dwarven gas chambers */
  {
    Room
    {
      Size = 10,30;
      Pos = XSize/2-5:XSize/2+5,2:4;
      AltarPossible = false;
      GenerateDoor = false;
      AllowLockedDoors = false;
      AllowBoobyTrappedDoors = true;
      Flags = NO_MONSTER_GENERATION;
      GenerateLanterns = false;

      Square, Random;
      {
        OTerrain = STEEL sign { Text = "Dwarven gas chambers. Welcome!"; }
      }

      Square, Pos 4, 0;
      {
        GTerrain = solidterrain(PARQUET);
        OTerrain = door;
        AttachRequired = true;
      }
      Square, Pos 5, 0;
      {
        GTerrain = solidterrain(PARQUET);
        OTerrain = door;
        AttachRequired = true;
      }
      Square, Pos 4, 29;
      {
        GTerrain = solidterrain(PARQUET);
        OTerrain = door;
        AttachRequired = true;
      }
      Square, Pos 5, 29;
      {
        GTerrain = solidterrain(PARQUET);
        OTerrain = door;
        AttachRequired = true;
      }

      Square, Random;
      {
        Items == Random { MinPrice = 500; Chance = 50; }
        Times = 8;
      }

      Square, BoundedRandom 1, 10, 9, 19, HAS_NO_OTERRAIN;
      {
        Items == Random { MinPrice = 200; Category = POTION; Chance = 50; }
        Times = 5;
      }

      Square, Random;
      {
        Items == mine { Team = MONSTER_TEAM; IsActive = true; Chance = 75; }
        Times = 12;
      }

      Square, Random;
      {
        Items == mine(BIG_MINE) { Team = MONSTER_TEAM; IsActive = true; Chance = 50; }
        Times = 8;
      }

      Square, Random;
      {
        Items == gasgrenade { Chance = 50; }
        Times = 12;
      }

      OTerrainMap
      {
        Size = 8, 10;
        Pos = 1, 10;
        Types
        {
          # = OBSIDIAN wall(BRICK_OLD);
        }
      }
      {
        ###..###
        ..#..#..
        ........
        ..#..#..
        ###..###
        ###..###
        ..#..#..
        ........
        ..#..#..
        ###..###
      }
      CharacterMap
      {
        Size = 8, 10;
        Pos = 1, 10;
        Types
        {
          # = 0;
          k = kamikazedwarf(INFUSCOR){ Team = 5; } /* Shop team, change this later*/
        }
      }
      {
        ###..###
        k.#..#.k
        ........
        ..#..#..
        ###..###
        ###..###
        ..#..#..
        ........
        k.#..#.k
        ###..###
      }
    }
  }

  RandomLevel 5:6; /* Experimental necro-chamber */
  {
    Room
    {
      Size = 17,10;
      AltarPossible = false;
      WallSquare = EBONY_WOOD solidterrain(GROUND), OCTIRON wall(BRICK_FINE);
      FloorSquare = EBONY_WOOD solidterrain(PARQUET), 0;
      GenerateDoor = false;
      GenerateLanterns = false;
      Flags = NO_MONSTER_GENERATION;

      OTerrainMap
      {
        Size = 15, 8;
        Pos = 1, 1;
        Types
        {
          # = STEEL barwall;
          % = STEEL barwall(BROKEN_BARWALL);
          G = STEEL door(BARDOOR) { Parameters = LOCKED; }
          B = STEEL brokendoor(BARDOOR) { Parameters = LOCKED; }
          A = GREEN_CRYSTAL altar(INFUSCOR);
        }
      }
      {
        ...#...#...#...
        ...#...#...#...
        #G###G###B%##G#
        ...............
        ...............
        ......A........
        ...............
        ...............
      }

      Square, Pos 2, 2;
      {
        Character = bear(MUTANT_BEAR);
      }

      Square, Pos 6, 2;
      {
        Character = skeleton(WARRIOR);
      }

      Square, Pos 14, 2;
      {
        Character = bear(CAVE_BEAR);
      }

      Square, Pos 9, 6;
      {
        Character = necromancer(MASTER_NECROMANCER) { Team = 5; Flags = IS_MASTER; } /* Shop team, change this later */
      }

      Square, Pos 0, 6;
      {
        OTerrain = METEORIC_STEEL door;
        AttachRequired = true;
      }

      Square, Pos 16, 6;
      {
        OTerrain = METEORIC_STEEL door;
        AttachRequired = true;
      }
    }
  }

  Level 2;
  {
    Room /* stylish little underground confluences */
    {
      Size = 7,7;
      GenerateFountains = true;
      Shape = ROUND_CORNERS;
      FloorSquare = solidterrain(GROUND), 0;
      UseFillSquareWalls = true;
      GenerateDoor = false;
      GenerateLanterns = false;
      AltarPossible = false;

      Square, Pos 3,0;
      {
        OTerrain = 0;
        AttachRequired = true;
      }
      Square, Pos 0,3;
      {
        OTerrain = 0;
        AttachRequired = true;
      }
      Square, Pos 6,3;
      {
        OTerrain = 0;
        AttachRequired = true;
      }
      Square, Pos 3,6;
      {
        OTerrain = 0;
        AttachRequired = true;
      }
    }

    Room
    {
      Size = 7,7;
      GenerateFountains = true;
      Shape = ROUND_CORNERS;
      FloorSquare = solidterrain(GROUND), 0;
      UseFillSquareWalls = true;
      GenerateDoor = false;
      GenerateLanterns = false;
      AltarPossible = false;

      Square, Pos 3,0;
      {
        OTerrain = 0;
        AttachRequired = true;
      }
      Square, Pos 0,3;
      {
        OTerrain = 0;
        AttachRequired = true;
      }
      Square, Pos 6,3;
      {
        OTerrain = 0;
        AttachRequired = true;
      }
      Square, Pos 3,6;
      {
        OTerrain = 0;
        AttachRequired = true;
      }
    }

    Room
    {
      Size = 7,7;
      GenerateFountains = true;
      Shape = ROUND_CORNERS;
      FloorSquare = solidterrain(GROUND), 0;
      UseFillSquareWalls = true;
      GenerateDoor = false;
      GenerateLanterns = false;
      AltarPossible = false;

      Square, Pos 3,0;
      {
        OTerrain = 0;
        AttachRequired = true;
      }
      Square, Pos 0,3;
      {
        OTerrain = 0;
        AttachRequired = true;
      }
      Square, Pos 6,3;
      {
        OTerrain = 0;
        AttachRequired = true;
      }
      Square, Pos 3,6;
      {
        OTerrain = 0;
        AttachRequired = true;
      }
    }

    Square, Random NOT_WALKABLE|ATTACHABLE;
    {
      OTerrain = stairs(STAIRS_UP);
      EntryIndex = STAIRS_UP;
      AttachRequired = true;
    }

    Square, Random NOT_WALKABLE|ATTACHABLE;
    {
      OTerrain = stairs(STAIRS_DOWN) { AttachedArea = 4; }
      EntryIndex = STAIRS_DOWN + 1;
      AttachRequired = true;
    }

    Room /* To get into the Ice Level */
    {
      Size = 11,7;
      AllowLockedDoors = true;
      AllowBoobyTrappedDoors = true;
      GenerateFountains = false;
      Shape = ROUND_CORNERS;
      WallSquare = GRAVEL solidterrain(GROUND), BASALT earth;
      FloorSquare = solidterrain(GROUND), 0;
      GenerateDoor = false;
      GenerateLanterns = false;
      AltarPossible = false;
      Flags = NO_MONSTER_GENERATION;

      OTerrainMap
      {
        Pos = 3,1;
        Size = 5,3;
        Types
        {
          # = BASALT earth;
        }
      }
      {
        ##.##
        .###.
        ..#..
      }

      Square, Pos 5,1;
      {
        OTerrain = stairs(STAIRS_DOWN) { AttachedArea = 3; }
        EntryIndex = STAIRS_DOWN;
      }

      Square, Pos 5,6; /*the door to the room!*/
      {
        OTerrain = 0;
        AttachRequired = true;
      }
    }
  }

  Level 3; /*ice cave*/
  {
    Rooms = 15:30;
    Size = 64, 36;
    LevelMessage = "It is deathly cold in here...";
    FillSquare = ICE solidterrain(GROUND), ICE earth;
    TunnelSquare = ICE solidterrain(GROUND), 0;
    BackGroundType = BLUE_FRACTAL;

    RoomDefault
    {
      Size = 8:17,8:17;
      Pos = 2:XSize-5,2:YSize-5;
      GenerateLanterns = false;
      Shape = ROUND_CORNERS;
      WallSquare = ICE solidterrain(GROUND), ICE earth;
      FloorSquare = ICE solidterrain(GROUND), 0;
      DoorSquare = ICE solidterrain(GROUND), 0;
      AltarPossible = false;
      GenerateFountains = false;
    }

    Room
    {
      Size = 13,13;
      AltarPossible = true;
      GenerateFountains = true;
      /*Shape = MAZE_ROOM;*/
      Shape = RECTANGLE;
    }

    Room
    {
      Square, Random IN_ROOM|HAS_NO_OTERRAIN;
      {
          OTerrain = stairs(STAIRS_UP) { AttachedArea = 2; }
          EntryIndex = STAIRS_UP;
      }
    }

    Square, Random HAS_NO_OTERRAIN;
    {
      OTerrain = ICE decoration(SHARD);
      Times = 10:30;
    }

    Square, Random NOT_IN_ROOM|HAS_NO_OTERRAIN;
    {
      OTerrain = ICE boulder(1);
      Times = 5:15;
    }

    Square, Random NOT_IN_ROOM|HAS_NO_OTERRAIN;
    {
      OTerrain = ICE boulder(2);
      Times = 5:15;
    }

    Square, Random;
    {
      Items == ICE stone;
      Times = 0:10;
    }

    Square, Random IN_ROOM;
    {
      Character = golem(BLUE_CRYSTAL);
    }

    Square, Random IN_ROOM;
    {
      Character = golem(ICE);
    }

    Square, Random IN_ROOM;
    {
      Character = golem(BLUE_CRYSTAL);
    }

    Square, Random;
    {
      Character = spider(LARGE);
      Times = 15;
    }
  }

  Level 4;
  {
    FillSquare = BONE solidterrain(GROUND), BASALT earth;
    TunnelSquare = BONE solidterrain(GROUND), 0;

    RoomDefault
    {
      WallSquare = BONE solidterrain(GROUND), BLACK_GRANITE wall(BRICK_OLD);
      FloorSquare = FIR_WOOD solidterrain(PARQUET), 0;
      DoorSquare = FIR_WOOD solidterrain(PARQUET), STEEL door;
    }

    Square, Random NOT_WALKABLE|ATTACHABLE;
    {
      OTerrain = stairs(STAIRS_UP) {AttachedArea = 2; AttachedEntry = STAIRS_DOWN + 1; } /* to get back to the right place */
      EntryIndex = STAIRS_UP;
      AttachRequired = true;
    }

    Square, Random NOT_WALKABLE|ATTACHABLE;
    {
      OTerrain = stairs(STAIRS_DOWN);
      EntryIndex = STAIRS_DOWN;
      AttachRequired = true;
    }
  }

  Level 5;
  {
    FillSquare = BONE solidterrain(GROUND), OBSIDIAN earth;
    TunnelSquare = BONE solidterrain(GROUND), 0;

    RoomDefault
    {
      WallSquare = BONE solidterrain(GROUND), OBSIDIAN wall(BRICK_OLD);
      FloorSquare = FIR_WOOD solidterrain(PARQUET), 0;
      DoorSquare = FIR_WOOD solidterrain(PARQUET), STEEL door;
    }

    Square, Random NOT_WALKABLE|ATTACHABLE;
    {
      OTerrain = stairs(STAIRS_UP);
      EntryIndex = STAIRS_UP;
      AttachRequired = true;
    }

    Square, Random NOT_WALKABLE|ATTACHABLE;
    {
      OTerrain = stairs(STAIRS_DOWN);
      EntryIndex = STAIRS_DOWN;
      AttachRequired = true;
    }
  }

  Level 6;
  {
    FillSquare = BONE solidterrain(GROUND), OBSIDIAN earth;
    TunnelSquare = BONE solidterrain(GROUND), 0;
    EnchantmentPlusChanceBase = 10;

    RoomDefault
    {
      WallSquare = BONE solidterrain(GROUND), OBSIDIAN wall(BRICK_OLD);
      FloorSquare = FIR_WOOD solidterrain(PARQUET), 0;
      DoorSquare = FIR_WOOD solidterrain(PARQUET), STEEL door;
    }

    Square, Random NOT_WALKABLE|ATTACHABLE;
    {
      OTerrain = stairs(STAIRS_UP);
      EntryIndex = STAIRS_UP;
      AttachRequired = true;
    }

    Square, Random NOT_WALKABLE|ATTACHABLE;
    {
      OTerrain = stairs(STAIRS_DOWN);
      EntryIndex = STAIRS_DOWN;
      AttachRequired = true;
    }
  }

  Level 7;  /* Dual enner beast level (??) */
  {
    FillSquare = BONE solidterrain(GROUND), OBSIDIAN earth;
    TunnelSquare = BONE solidterrain(GROUND), 0;
    EnchantmentPlusChanceDelta = 10;
    LevelMessage = "You hear a wailing scream in the distance. An enner beast must dwell in the level!";

    RoomDefault
    {
      WallSquare = BONE solidterrain(GROUND), OBSIDIAN wall(BRICK_OLD);
      FloorSquare = FIR_WOOD solidterrain(PARQUET), 0;
      DoorSquare = FIR_WOOD solidterrain(PARQUET), METEORIC_STEEL door;
    }

    Items = 40:70;
    Size = 80, 26;
    ItemMinPriceBase = 20;

    Square, Random NOT_WALKABLE|ATTACHABLE;
    {
      OTerrain = stairs(STAIRS_UP);
      EntryIndex = STAIRS_UP;
      AttachRequired = true;
    }

    Square, Random NOT_WALKABLE|ATTACHABLE;
    {
      OTerrain = stairs(STAIRS_DOWN);
      EntryIndex = STAIRS_DOWN;
      AttachRequired = true;
    }
  }

  Level 8;  /* Tactical level */
  {
    FillSquare = GNEISS solidterrain(GROUND), OCTIRON earth;
    TunnelSquare = GNEISS solidterrain(GROUND), 0;
    CanGenerateBone = false;

    RoomDefault
    {
      WallSquare = GNEISS solidterrain(GROUND), OCTIRON wall(BRICK_FINE);
      FloorSquare = TEAK_WOOD solidterrain(PARQUET), 0;
      DoorSquare = TEAK_WOOD solidterrain(PARQUET), SAPPHIRE door;
    }

    Size = 42, 26;
    EnchantmentMinusChanceBase = 5;
    EnchantmentPlusChanceBase = 0;
    EnchantmentPlusChanceDelta = 0;
    LOSModifier = 48;
    ItemMinPriceBase = 30;

    Square, Random NOT_WALKABLE|ATTACHABLE;
    {
      OTerrain = stairs(STAIRS_UP);
      EntryIndex = STAIRS_UP;
      AttachRequired = true;
    }

    Square, Random NOT_WALKABLE|ATTACHABLE;
    {
      OTerrain = stairs(STAIRS_DOWN);
      EntryIndex = STAIRS_DOWN;
      AttachRequired = true;
    }
  }

  Level 9; /* Gravekeeper level (?) */
  {
    FillSquare = SLATE solidterrain(GROUND), OCTIRON earth;
    TunnelSquare = SLATE solidterrain(GROUND), 0;
    Rooms = 30:40;
    Size = 25, 90;
    EnchantmentMinusChanceBase = 10;
    EnchantmentPlusChanceBase = 0;
    EnchantmentPlusChanceDelta = 0;
    ItemMinPriceBase = 40;

    RoomDefault
    {
      WallSquare = SLATE solidterrain(GROUND), OCTIRON wall(BRICK_FINE);
      FloorSquare = TEAK_WOOD solidterrain(PARQUET), 0;
      DoorSquare = TEAK_WOOD solidterrain(PARQUET), OCTIRON door;
      Pos = 2:XSize-5,2:YSize-5;
      Size = 3:6,3:6;
    }

    Room /* Greater maze room */
    {
      Pos = 2, YSize/4:YSize/4 + 10;
      Size = 21,39;
      AltarPossible = true;
      GenerateFountains = true;
      /*Shape = MAZE_ROOM;*/
      Shape = RECTANGLE;
    }

    Square, BoundedRandom 1, 1, XSize - 2, YSize * 1 / 5, NOT_WALKABLE|ATTACHABLE;
    {
      OTerrain = stairs(STAIRS_UP);
      EntryIndex = STAIRS_UP;
      AttachRequired = true;
    }

    Square, BoundedRandom 1, YSize - YSize * 1 / 5, XSize - 2, YSize - 2, NOT_WALKABLE|ATTACHABLE;
    {
      OTerrain = stairs(STAIRS_DOWN);
      EntryIndex = STAIRS_DOWN;
      AttachRequired = true;
    }
  }

  Level 10; /* Final boss level */
  {
    Items = 5:10;
    EnchantmentMinusChanceBase = 15;
    EnchantmentPlusChanceBase = 0;
    EnchantmentPlusChanceDelta = 0;
    ItemMinPriceBase = 50;
    FillSquare = OBSIDIAN solidterrain(GROUND), OCTIRON earth;
    TunnelSquare = OBSIDIAN solidterrain(GROUND), 0;
    CanGenerateBone = false;

    RoomDefault
    {
      WallSquare = OBSIDIAN solidterrain(GROUND), OCTIRON wall(BRICK_FINE);
      FloorSquare = EBONY_WOOD solidterrain(PARQUET), 0;
      DoorSquare = EBONY_WOOD solidterrain(PARQUET), RUBY door;
    }

    Square, Random NOT_WALKABLE|ATTACHABLE;
    {
      OTerrain = stairs(STAIRS_UP);
      EntryIndex = STAIRS_UP;
      AttachRequired = true;
    }
  }
}
